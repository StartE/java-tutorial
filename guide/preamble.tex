%%%%%%%%%%%%%%%%%%
% 标题左对齐
%\usepackage[raggedright]{titlesec}
% 页边距设置
% marginpar=2cm解决margin note在ctex book下无法留出足够空白问题
% 标准的16开，适合于计算机类图书出版
\usepackage[paperheight=260mm, paperwidth=185mm, marginpar=2cm,top=3cm,bottom=3cm,left=2.54cm,right=2.54cm]{geometry}
% 使用A4打印出版，需要根据实际打印纸张尺寸设定
\usepackage[cam,a4,center]{crop}

% A4版本，适合打印
%\usepackage[paperheight=297mm, paperwidth=210mm, marginpar=2cm,top=1.65cm,bottom=1.65cm,left=2cm,right=2cm]{geometry}

% 确定使用了tikz绘制的图片并且在图片中包含beamer中的overlay设置才需要此宏包
%\usepackage{beamerarticle}
% 页眉页脚设置
\usepackage{fancyhdr}
\pagestyle{fancy} % 默认的效果也可以接受
\fancyhf{}                                                  % 清空页眉页脚
\fancyhead[LE,RO]{\thepage}                                 % 页码：偶数页左,奇数页右
\fancyhead[RE]{\leftmark}                                   % 偶数页右
\fancyhead[LO]{\rightmark}                                  % 奇数页左
\fancypagestyle{plain}{ % 重新定义plain样式，在章等的首页使用plain样式 
    \fancyhf{}
    \cfoot{\thepage} % 页脚中间显示页码
    \renewcommand{\headrulewidth}{0pt} % 清除页眉线
}
% 重新设置fancyhdr的headheight，避免报告Package Fancyhdr Warning: \headheight is too small (12.0pt)
\setlength{\headheight}{14pt} 

% 目录样式：解决目录中的省略号太稀疏问题
%\usepackage{tocloft} %暂时不需要这么重量级的宏包
\renewcommand\@dotsep{1} %默认值是4.5

% 图片样式：caption字体小一号，参见caption package guide
\usepackage[margin=10pt,font=small,labelfont=bf,labelsep=endash]{caption}

% 表格样式
% caption在表格上面
% 表格字体小一号
\usepackage{floatrow}
\floatsetup[table]{font=small,capposition=top}

% 章的序号样式
\ctexset{
    chapter/number = \arabic{chapter},
    chapter/numberformat = \color{blue}\zihao{0}\itshape,
}
% 调整字间距,I don't know the effect,也许ctex已经这样设置了，需要调查?
%\renewcommand{\CJKglue}{\hskip 0.9bp plus 0.03\baselineskip minus 0.03\baselineskip}
\input{/home/subaochen/git/writing-common/translations.tex}
\input{/home/subaochen/git/writing-common/listing.tex}

% 页面章节导航
\usepackage[contents={},opacity=1,scale=1,color=white]{background}
\usepackage{tikzpagenodes}
\usepackage{totcount}
\usetikzlibrary{calc}
\usepackage{assoccnt}

\newif\ifMaterial

\newlength\LabelSize
\setlength\LabelSize{2.5cm}

% auxiliary counter
\newcounter{chapshift}
\DeclareAssociatedCounters{chapter}{chapshift}

\AtBeginDocument{%
    \regtotcounter{chapter}
    \setlength\LabelSize{\dimexpr\textheight/\totvalue{chapter}\relax}
    \ifdim\LabelSize>2.5cm\relax
    \global\setlength\LabelSize{2.5cm}
    \fi
}

\newcommand\AddLabels{%
    \Materialtrue%
    \AddEverypageHook{%
        \ifMaterial%
        \ifodd\value{page} %
        \backgroundsetup{
            angle=90,
            position={current page.east|-current page text area.north  east},
            vshift=12pt,
            %hshift=-\thechapter*\LabelSize,
            hshift=-\thechapshift*\LabelSize,
            contents={%
                \tikz\node[fill=DodgerBlue4,anchor=west,text width=\LabelSize,
                align=center,text height=15pt,text depth=13pt,font=\large\sffamily] {\thechapter};
            }%
        }
        \else
        \backgroundsetup{
            angle=90,
            position={current page.west|-current page text area.north west},
            vshift=-12pt,
            hshift=-\thechapshift*\LabelSize,
            %hshift=-\thechapter*\LabelSize,
            contents={%
                \tikz\node[fill=DodgerBlue4,anchor=west,text width=\LabelSize,
                align=center,text height=15pt,text depth=13pt,font=\large\sffamily] {\rotatebox{180}{\thechapter}};
            }%
        }
        \fi
        \BgMaterial%
    \else\relax\fi}%
}
\newcommand\RemoveLabels{\Materialfalse}
